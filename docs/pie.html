<!DOCTYPE html>
<head>
<meta charset="utf-8">
<style>

body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: 0px;
  padding: 0px;
  width: 100%;
}

text {
  font: 10px sans-serif;
}
</style>
<script src="//d3js.org/d3.v3.min.js"></script>
</head>
<body>
<svg width="100%"></svg>
<script>

var width = document.body.clientWidth;
var height = window.innerHeight;


d3.csv("personas.csv", function(error, data) {
  var svg = d3.select("svg").attr({
    "height":height
  });

function pieChart(svg,width,height,clase) {
  var svg = svg.append("g").attr("class",clase)
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

  var radius = Math.min(width, height) / 2;
  console.log(radius);

  var color = d3.scale.category20();

  var pie = d3.layout.pie()
    .value(function(d) { return d.key; })
    .sort(null);

  var arc = d3.svg.arc()
    .innerRadius(radius - (radius*.3))
    .outerRadius(radius - (radius*.06));
  
  if (error) throw error;

function Unidad(data,nombre) {
    var total = data.filter(function(d) {
      return d["UNIDAD DE ADSCRIPCIÓN"] == nombre;
    });
    var hombres = total.filter(function(d) { return d["SEXO"] == "H"; }).length
    var mujeres = total.filter(function(d) { return d["SEXO"] == "M"; }).length;
    total = total.length;

    return [{key:hombres,sexo:"H"},{key:mujeres,sexo:"M"}]
}

  var origen = [{key:0,sexo:"H"},{key:0,sexo:"M"}];


  var path = svg.datum(origen).selectAll("path")
      .data(pie)
    .enter().append("path")
      .attr("fill", function(d, i) { return color(i); })
      .attr("d", arc)
      .each(function(d) { this._current = d; }); // store the initial angles


  svg.append("rect")
    .attr({
	"x": width/2, "y":height/2, "width":20, "height":20, "id":"OFICIALÍA MAYOR"
     }).on("click",function() { var v = d3.select(this).attr("id"); change(data,v) })


  function change(data,nombre) {
    var nuevaData = Unidad(data,nombre)
    path.data(pie(nuevaData))
    path.transition().duration(750).attrTween("d", arcTween); // redraw the arcs
  }

  function arcTween(a) {
    var i = d3.interpolate(this._current, a);
    this._current = i(0);
    return function(t) {
      return arc(i(t));
    };
  }

}

pieChart(svg,100,100,"uno");
d3.select(".uno").attr("transform","translate(" + width/2 + "," + height/2 + ")");
});



</script>
</body>
